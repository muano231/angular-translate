{"ast":null,"code":"function _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) {\n    return typeof obj;\n  } : function (obj) {\n    return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n  }, _typeof(obj);\n}\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor);\n  }\n}\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, \"prototype\", {\n    writable: false\n  });\n  return Constructor;\n}\nfunction _toPropertyKey(arg) {\n  var key = _toPrimitive(arg, \"string\");\n  return _typeof(key) === \"symbol\" ? key : String(key);\n}\nfunction _toPrimitive(input, hint) {\n  if (_typeof(input) !== \"object\" || input === null) return input;\n  var prim = input[Symbol.toPrimitive];\n  if (prim !== undefined) {\n    var res = prim.call(input, hint || \"default\");\n    if (_typeof(res) !== \"object\") return res;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (hint === \"string\" ? String : Number)(input);\n}\nimport { defaults, debounce, isMissingOption, interpolate, getPath, setPath, pushPath, defer } from './utils.js';\nimport request from './request.js';\nvar getDefaults = function getDefaults() {\n  return {\n    loadPath: 'https://api.locize.app/{{projectId}}/{{version}}/{{lng}}/{{ns}}',\n    privatePath: 'https://api.locize.app/private/{{projectId}}/{{version}}/{{lng}}/{{ns}}',\n    getLanguagesPath: 'https://api.locize.app/languages/{{projectId}}',\n    addPath: 'https://api.locize.app/missing/{{projectId}}/{{version}}/{{lng}}/{{ns}}',\n    updatePath: 'https://api.locize.app/update/{{projectId}}/{{version}}/{{lng}}/{{ns}}',\n    referenceLng: 'en',\n    crossDomain: true,\n    setContentTypeJSON: false,\n    version: 'latest',\n    private: false,\n    translatedPercentageThreshold: 0.9,\n    failLoadingOnEmptyJSON: false,\n    allowedAddOrUpdateHosts: ['localhost'],\n    onSaved: false,\n    reloadInterval: typeof window !== 'undefined' ? false : 60 * 60 * 1000,\n    checkForProjectTimeout: 3 * 1000,\n    storageExpiration: 60 * 60 * 1000,\n    writeDebounce: 5 * 1000\n  };\n};\nvar hasLocalStorageSupport;\ntry {\n  hasLocalStorageSupport = typeof window !== 'undefined' && window.localStorage !== null;\n  var testKey = 'notExistingLocizeProject';\n  window.localStorage.setItem(testKey, 'foo');\n  window.localStorage.removeItem(testKey);\n} catch (e) {\n  hasLocalStorageSupport = false;\n}\nfunction getStorage(storageExpiration) {\n  var setProjectNotExisting = function setProjectNotExisting() {};\n  var isProjectNotExisting = function isProjectNotExisting() {};\n  if (hasLocalStorageSupport) {\n    setProjectNotExisting = function setProjectNotExisting(projectId) {\n      window.localStorage.setItem(\"notExistingLocizeProject_\".concat(projectId), Date.now());\n    };\n    isProjectNotExisting = function isProjectNotExisting(projectId) {\n      var ret = window.localStorage.getItem(\"notExistingLocizeProject_\".concat(projectId));\n      if (!ret) return false;\n      if (Date.now() - ret > storageExpiration) {\n        window.localStorage.removeItem(\"notExistingLocizeProject_\".concat(projectId));\n        return false;\n      }\n      return true;\n    };\n  } else if (typeof document !== 'undefined') {\n    setProjectNotExisting = function setProjectNotExisting(projectId) {\n      var date = new Date();\n      date.setTime(date.getTime() + storageExpiration);\n      var expires = \"; expires=\".concat(date.toGMTString());\n      var name = \"notExistingLocizeProject_\".concat(projectId);\n      try {\n        document.cookie = \"\".concat(name, \"=\").concat(Date.now()).concat(expires, \";path=/\");\n      } catch (err) {}\n    };\n    isProjectNotExisting = function isProjectNotExisting(projectId) {\n      var name = \"notExistingLocizeProject_\".concat(projectId);\n      var nameEQ = \"\".concat(name, \"=\");\n      try {\n        var ca = document.cookie.split(';');\n        for (var i = 0; i < ca.length; i++) {\n          var c = ca[i];\n          while (c.charAt(0) === ' ') {\n            c = c.substring(1, c.length);\n          }\n          if (c.indexOf(nameEQ) === 0) return true;\n        }\n      } catch (err) {}\n      return false;\n    };\n  }\n  return {\n    setProjectNotExisting: setProjectNotExisting,\n    isProjectNotExisting: isProjectNotExisting\n  };\n}\nvar getCustomRequestInfo = function getCustomRequestInfo(url, options, payload) {\n  var headers = {};\n  if (options.authorize && options.apiKey) {\n    headers.Authorization = options.apiKey;\n  }\n  if (payload || options.setContentTypeJSON) {\n    headers['Content-Type'] = 'application/json';\n  }\n  return {\n    method: payload ? 'POST' : 'GET',\n    url: url,\n    headers: headers,\n    body: payload\n  };\n};\nvar handleCustomRequest = function handleCustomRequest(opt, info, cb) {\n  if (opt.request.length === 1) {\n    try {\n      var r = opt.request(info);\n      if (r && typeof r.then === 'function') {\n        r.then(function (data) {\n          return cb(null, data);\n        }).catch(cb);\n      } else {\n        cb(null, r);\n      }\n    } catch (err) {\n      cb(err);\n    }\n    return;\n  }\n  opt.request(info, cb);\n};\nvar I18NextLocizeBackend = function () {\n  function I18NextLocizeBackend(services) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    var allOptions = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    var callback = arguments.length > 3 ? arguments[3] : undefined;\n    _classCallCheck(this, I18NextLocizeBackend);\n    this.services = services;\n    this.options = options;\n    this.allOptions = allOptions;\n    this.type = 'backend';\n    if (services && services.projectId) {\n      this.init(null, services, allOptions, options);\n    } else {\n      this.init(services, options, allOptions, callback);\n    }\n  }\n  _createClass(I18NextLocizeBackend, [{\n    key: \"init\",\n    value: function init(services) {\n      var _this = this;\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var allOptions = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n      var callback = arguments.length > 3 ? arguments[3] : undefined;\n      if (!options.referenceLng && allOptions.fallbackLng && Array.isArray(allOptions.fallbackLng) && allOptions.fallbackLng[0] !== 'dev') {\n        options.referenceLng = allOptions.fallbackLng[0];\n      }\n      this.services = services;\n      var defOpt = getDefaults();\n      var passedOpt = defaults(options, this.options || {});\n      if (passedOpt.reloadInterval && passedOpt.reloadInterval < 5 * 60 * 1000) {\n        console.warn('Your configured reloadInterval option is to low.');\n        passedOpt.reloadInterval = defOpt.reloadInterval;\n      }\n      this.options = defaults(options, this.options || {}, defOpt);\n      this.allOptions = allOptions;\n      this.somethingLoaded = false;\n      this.isProjectNotExisting = false;\n      this.storage = getStorage(this.options.storageExpiration);\n      if (this.options.pull) {\n        console.warn('The pull API was removed use \"private: true\" option instead: https://docs.locize.com/integration/api#fetch-private-namespace-resources');\n      }\n      var hostname = typeof window !== 'undefined' && window.location && window.location.hostname;\n      if (hostname) {\n        this.isAddOrUpdateAllowed = typeof this.options.allowedAddOrUpdateHosts === 'function' ? this.options.allowedAddOrUpdateHosts(hostname) : this.options.allowedAddOrUpdateHosts.indexOf(hostname) > -1;\n        if (services && services.logger && (allOptions.saveMissing || allOptions.updateMissing)) {\n          if (!this.isAddOrUpdateAllowed) {\n            services.logger.warn(typeof this.options.allowedAddOrUpdateHosts === 'function' ? \"locize-backend: will not save or update missings because allowedAddOrUpdateHosts returned false for the host \\\"\".concat(hostname, \"\\\".\") : \"locize-backend: will not save or update missings because the host \\\"\".concat(hostname, \"\\\" was not in the list of allowedAddOrUpdateHosts: \").concat(this.options.allowedAddOrUpdateHosts.join(', '), \" (matches need to be exact).\"));\n          } else if (hostname !== 'localhost') {\n            services.logger.warn(\"locize-backend: you are using the save or update missings feature from this host \\\"\".concat(hostname, \"\\\".\\nMake sure you will not use it in production!\\nhttps://docs.locize.com/guides-tips-and-tricks/going-production\"));\n          }\n        }\n      } else {\n        this.isAddOrUpdateAllowed = true;\n      }\n      if (typeof callback === 'function') {\n        this.getOptions(function (err, opts, languages) {\n          if (err) return callback(err);\n          _this.options.referenceLng = options.referenceLng || opts.referenceLng || _this.options.referenceLng;\n          callback(null, opts, languages);\n        });\n      }\n      this.queuedWrites = {\n        pending: {}\n      };\n      this.debouncedProcess = debounce(this.process, this.options.writeDebounce);\n      if (this.interval) clearInterval(this.interval);\n      if (this.options.reloadInterval && this.options.projectId) {\n        this.interval = setInterval(function () {\n          return _this.reload();\n        }, this.options.reloadInterval);\n      }\n    }\n  }, {\n    key: \"reload\",\n    value: function reload() {\n      var _this2 = this;\n      var _ref = this.services || {\n          logger: console\n        },\n        backendConnector = _ref.backendConnector,\n        languageUtils = _ref.languageUtils,\n        logger = _ref.logger;\n      if (!backendConnector) return;\n      var currentLanguage = backendConnector.language;\n      if (currentLanguage && currentLanguage.toLowerCase() === 'cimode') return;\n      var toLoad = [];\n      var append = function append(lng) {\n        var lngs = languageUtils.toResolveHierarchy(lng);\n        lngs.forEach(function (l) {\n          if (toLoad.indexOf(l) < 0) toLoad.push(l);\n        });\n      };\n      append(currentLanguage);\n      if (this.allOptions.preload) this.allOptions.preload.forEach(function (l) {\n        return append(l);\n      });\n      toLoad.forEach(function (lng) {\n        _this2.allOptions.ns.forEach(function (ns) {\n          backendConnector.read(lng, ns, 'read', null, null, function (err, data) {\n            if (err) logger.warn(\"loading namespace \".concat(ns, \" for language \").concat(lng, \" failed\"), err);\n            if (!err && data) logger.log(\"loaded namespace \".concat(ns, \" for language \").concat(lng), data);\n            backendConnector.loaded(\"\".concat(lng, \"|\").concat(ns), err, data);\n          });\n        });\n      });\n    }\n  }, {\n    key: \"getLanguages\",\n    value: function getLanguages(callback) {\n      var _this3 = this;\n      var deferred;\n      if (!callback) {\n        deferred = defer();\n        callback = function callback(err, ret) {\n          if (err) return deferred.reject(err);\n          deferred.resolve(ret);\n        };\n      }\n      var isMissing = isMissingOption(this.options, ['projectId']);\n      if (isMissing) return callback(new Error(isMissing));\n      var url = interpolate(this.options.getLanguagesPath, {\n        projectId: this.options.projectId\n      });\n      if (!this.isProjectNotExisting && this.storage.isProjectNotExisting(this.options.projectId)) {\n        this.isProjectNotExisting = true;\n      }\n      if (this.isProjectNotExisting) return callback(new Error(\"locize project \".concat(this.options.projectId, \" does not exist!\")));\n      this.getLanguagesCalls = this.getLanguagesCalls || [];\n      this.getLanguagesCalls.push(callback);\n      if (this.getLanguagesCalls.length > 1) return;\n      this.loadUrl({}, url, function (err, ret, info) {\n        if (!_this3.somethingLoaded && info && info.resourceNotExisting) {\n          _this3.isProjectNotExisting = true;\n          _this3.storage.setProjectNotExisting(_this3.options.projectId);\n          var e = new Error(\"locize project \".concat(_this3.options.projectId, \" does not exist!\"));\n          var _clbs = _this3.getLanguagesCalls;\n          _this3.getLanguagesCalls = [];\n          return _clbs.forEach(function (clb) {\n            return clb(e);\n          });\n        }\n        if (ret) {\n          var referenceLng = Object.keys(ret).reduce(function (mem, k) {\n            var item = ret[k];\n            if (item.isReferenceLanguage) mem = k;\n            return mem;\n          }, '');\n          if (referenceLng && _this3.options.referenceLng !== referenceLng) {\n            _this3.options.referenceLng = referenceLng;\n          }\n        }\n        _this3.somethingLoaded = true;\n        var clbs = _this3.getLanguagesCalls;\n        _this3.getLanguagesCalls = [];\n        clbs.forEach(function (clb) {\n          return clb(err, ret);\n        });\n      });\n      return deferred;\n    }\n  }, {\n    key: \"getOptions\",\n    value: function getOptions(callback) {\n      var _this4 = this;\n      var deferred;\n      if (!callback) {\n        deferred = defer();\n        callback = function callback(err, ret) {\n          if (err) return deferred.reject(err);\n          deferred.resolve(ret);\n        };\n      }\n      this.getLanguages(function (err, data) {\n        if (err) return callback(err);\n        var keys = Object.keys(data);\n        if (!keys.length) {\n          return callback(new Error('was unable to load languages via API'));\n        }\n        var lngs = keys.reduce(function (mem, k) {\n          var item = data[k];\n          if (item.translated[_this4.options.version] && item.translated[_this4.options.version] >= _this4.options.translatedPercentageThreshold) {\n            mem.push(k);\n          }\n          return mem;\n        }, []);\n        var hasRegion = keys.reduce(function (mem, k) {\n          if (k.indexOf('-') > -1) return true;\n          return mem;\n        }, false);\n        callback(null, {\n          fallbackLng: _this4.options.referenceLng,\n          referenceLng: _this4.options.referenceLng,\n          supportedLngs: lngs,\n          load: hasRegion ? 'all' : 'languageOnly'\n        }, data);\n      });\n      return deferred;\n    }\n  }, {\n    key: \"checkIfProjectExists\",\n    value: function checkIfProjectExists(callback) {\n      var _this5 = this;\n      var _ref2 = this.services || {\n          logger: console\n        },\n        logger = _ref2.logger;\n      if (this.somethingLoaded) {\n        if (callback) callback(null);\n        return;\n      }\n      if (this.alreadyRequestedCheckIfProjectExists) {\n        setTimeout(function () {\n          return _this5.checkIfProjectExists(callback);\n        }, this.options.checkForProjectTimeout);\n        return;\n      }\n      this.alreadyRequestedCheckIfProjectExists = true;\n      this.getLanguages(function (err) {\n        if (err && err.message && err.message.indexOf('does not exist') > 0) {\n          if (logger) logger.error(err.message);\n        }\n        if (callback) callback(err);\n      });\n    }\n  }, {\n    key: \"read\",\n    value: function read(language, namespace, callback) {\n      var _this6 = this;\n      var _ref3 = this.services || {\n          logger: console\n        },\n        logger = _ref3.logger;\n      var url;\n      var options = {};\n      if (this.options.private) {\n        var isMissing = isMissingOption(this.options, ['projectId', 'version', 'apiKey']);\n        if (isMissing) return callback(new Error(isMissing), false);\n        url = interpolate(this.options.privatePath, {\n          lng: language,\n          ns: namespace,\n          projectId: this.options.projectId,\n          version: this.options.version\n        });\n        options = {\n          authorize: true\n        };\n      } else {\n        var _isMissing = isMissingOption(this.options, ['projectId', 'version']);\n        if (_isMissing) return callback(new Error(_isMissing), false);\n        url = interpolate(this.options.loadPath, {\n          lng: language,\n          ns: namespace,\n          projectId: this.options.projectId,\n          version: this.options.version\n        });\n      }\n      if (!this.isProjectNotExisting && this.storage.isProjectNotExisting(this.options.projectId)) {\n        this.isProjectNotExisting = true;\n      }\n      if (this.isProjectNotExisting) {\n        var err = new Error(\"locize project \".concat(this.options.projectId, \" does not exist!\"));\n        if (logger) logger.error(err.message);\n        if (callback) callback(err);\n        return;\n      }\n      this.loadUrl(options, url, function (err, ret, info) {\n        if (!_this6.somethingLoaded) {\n          if (info && info.resourceNotExisting) {\n            setTimeout(function () {\n              return _this6.checkIfProjectExists();\n            }, _this6.options.checkForProjectTimeout);\n          } else {\n            _this6.somethingLoaded = true;\n          }\n        }\n        callback(err, ret);\n      });\n    }\n  }, {\n    key: \"loadUrl\",\n    value: function loadUrl(options, url, payload, callback) {\n      var _this7 = this;\n      options = defaults(options, this.options);\n      if (typeof payload === 'function') {\n        callback = payload;\n        payload = undefined;\n      }\n      callback = callback || function () {};\n      var clb = function clb(err, res) {\n        var resourceNotExisting = res && res.resourceNotExisting;\n        if (res && (res.status === 408 || res.status === 400)) {\n          return callback('failed loading ' + url, true, {\n            resourceNotExisting: resourceNotExisting\n          });\n        }\n        if (res && (res.status >= 500 && res.status < 600 || !res.status)) {\n          return callback('failed loading ' + url, true, {\n            resourceNotExisting: resourceNotExisting\n          });\n        }\n        if (res && res.status >= 400 && res.status < 500) {\n          return callback('failed loading ' + url, false, {\n            resourceNotExisting: resourceNotExisting\n          });\n        }\n        if (!res && err && err.message && err.message.indexOf('Failed to fetch') > -1) {\n          return callback('failed loading ' + url, true, {\n            resourceNotExisting: resourceNotExisting\n          });\n        }\n        if (err) return callback(err, false);\n        var ret, parseErr;\n        try {\n          if (typeof res.data === 'string') {\n            ret = JSON.parse(res.data);\n          } else {\n            ret = res.data;\n          }\n        } catch (e) {\n          parseErr = 'failed parsing ' + url + ' to json';\n        }\n        if (parseErr) return callback(parseErr, false);\n        if (_this7.options.failLoadingOnEmptyJSON && !Object.keys(ret).length) {\n          return callback('loaded result empty for ' + url, false, {\n            resourceNotExisting: resourceNotExisting\n          });\n        }\n        callback(null, ret, {\n          resourceNotExisting: resourceNotExisting\n        });\n      };\n      if (!this.options.request || url.indexOf(\"/languages/\".concat(options.projectId)) > 0) return request(options, url, payload, clb);\n      var info = getCustomRequestInfo(url, options, payload);\n      handleCustomRequest(this.options, info, clb);\n    }\n  }, {\n    key: \"create\",\n    value: function create(languages, namespace, key, fallbackValue, callback, options) {\n      var _this8 = this;\n      if (typeof callback !== 'function') callback = function callback() {};\n      this.checkIfProjectExists(function (err) {\n        if (err) return callback(err);\n        var isMissing = isMissingOption(_this8.options, ['projectId', 'version', 'apiKey', 'referenceLng']);\n        if (isMissing) return callback(new Error(isMissing));\n        if (!_this8.isAddOrUpdateAllowed) {\n          return callback('host is not allowed to create key.');\n        }\n        if (typeof languages === 'string') languages = [languages];\n        if (languages.filter(function (l) {\n          return l === _this8.options.referenceLng;\n        }).length < 1) {\n          _this8.services && _this8.services.logger && _this8.services.logger.warn(\"locize-backend: will not save missings because the reference language \\\"\".concat(_this8.options.referenceLng, \"\\\" was not in the list of to save languages: \").concat(languages.join(', '), \" (open your site in the reference language to save missings).\"));\n        }\n        languages.forEach(function (lng) {\n          if (lng === _this8.options.referenceLng) {\n            _this8.queue.call(_this8, _this8.options.referenceLng, namespace, key, fallbackValue, callback, options);\n          }\n        });\n      });\n    }\n  }, {\n    key: \"update\",\n    value: function update(languages, namespace, key, fallbackValue, callback, options) {\n      var _this9 = this;\n      if (typeof callback !== 'function') callback = function callback() {};\n      this.checkIfProjectExists(function (err) {\n        if (err) return callback(err);\n        var isMissing = isMissingOption(_this9.options, ['projectId', 'version', 'apiKey', 'referenceLng']);\n        if (isMissing) return callback(new Error(isMissing));\n        if (!_this9.isAddOrUpdateAllowed) {\n          return callback('host is not allowed to update key.');\n        }\n        if (!options) options = {};\n        if (typeof languages === 'string') languages = [languages];\n        options.isUpdate = true;\n        languages.forEach(function (lng) {\n          if (lng === _this9.options.referenceLng) {\n            _this9.queue.call(_this9, _this9.options.referenceLng, namespace, key, fallbackValue, callback, options);\n          }\n        });\n      });\n    }\n  }, {\n    key: \"writePage\",\n    value: function writePage(lng, namespace, missings, callback) {\n      var missingUrl = interpolate(this.options.addPath, {\n        lng: lng,\n        ns: namespace,\n        projectId: this.options.projectId,\n        version: this.options.version\n      });\n      var updatesUrl = interpolate(this.options.updatePath, {\n        lng: lng,\n        ns: namespace,\n        projectId: this.options.projectId,\n        version: this.options.version\n      });\n      var hasMissing = false;\n      var hasUpdates = false;\n      var payloadMissing = {};\n      var payloadUpdate = {};\n      missings.forEach(function (item) {\n        var value = item.options && item.options.tDescription ? {\n          value: item.fallbackValue || '',\n          context: {\n            text: item.options.tDescription\n          }\n        } : item.fallbackValue || '';\n        if (item.options && item.options.isUpdate) {\n          if (!hasUpdates) hasUpdates = true;\n          payloadUpdate[item.key] = value;\n        } else {\n          if (!hasMissing) hasMissing = true;\n          payloadMissing[item.key] = value;\n        }\n      });\n      var todo = 0;\n      if (hasMissing) todo++;\n      if (hasUpdates) todo++;\n      var doneOne = function doneOne(err) {\n        todo--;\n        if (!todo) callback(err);\n      };\n      if (!todo) doneOne();\n      if (hasMissing) {\n        if (!this.options.request) {\n          request(defaults({\n            authorize: true\n          }, this.options), missingUrl, payloadMissing, doneOne);\n        } else {\n          var info = getCustomRequestInfo(missingUrl, defaults({\n            authorize: true\n          }, this.options), payloadMissing);\n          handleCustomRequest(this.options, info, doneOne);\n        }\n      }\n      if (hasUpdates) {\n        if (!this.options.request) {\n          request(defaults({\n            authorize: true\n          }, this.options), updatesUrl, payloadUpdate, doneOne);\n        } else {\n          var _info = getCustomRequestInfo(updatesUrl, defaults({\n            authorize: true\n          }, this.options), payloadUpdate);\n          handleCustomRequest(this.options, _info, doneOne);\n        }\n      }\n    }\n  }, {\n    key: \"write\",\n    value: function write(lng, namespace) {\n      var _this10 = this;\n      var lock = getPath(this.queuedWrites, ['locks', lng, namespace]);\n      if (lock) return;\n      var missings = getPath(this.queuedWrites, [lng, namespace]);\n      setPath(this.queuedWrites, [lng, namespace], []);\n      var pageSize = 1000;\n      var clbs = missings.filter(function (m) {\n        return m.callback;\n      }).map(function (missing) {\n        return missing.callback;\n      });\n      if (missings.length) {\n        (function () {\n          setPath(_this10.queuedWrites, ['locks', lng, namespace], true);\n          var namespaceSaved = function namespaceSaved() {\n            setPath(_this10.queuedWrites, ['locks', lng, namespace], false);\n            clbs.forEach(function (clb) {\n              return clb();\n            });\n            if (_this10.options.onSaved) _this10.options.onSaved(lng, namespace);\n            _this10.debouncedProcess(lng, namespace);\n          };\n          var amountOfPages = missings.length / pageSize;\n          var pagesDone = 0;\n          var page = missings.splice(0, pageSize);\n          _this10.writePage(lng, namespace, page, function () {\n            pagesDone++;\n            if (pagesDone >= amountOfPages) namespaceSaved();\n          });\n          while (page.length === pageSize) {\n            page = missings.splice(0, pageSize);\n            if (page.length) {\n              _this10.writePage(lng, namespace, page, function () {\n                pagesDone++;\n                if (pagesDone >= amountOfPages) namespaceSaved();\n              });\n            }\n          }\n        })();\n      }\n    }\n  }, {\n    key: \"process\",\n    value: function process() {\n      var _this11 = this;\n      Object.keys(this.queuedWrites).forEach(function (lng) {\n        if (lng === 'locks') return;\n        Object.keys(_this11.queuedWrites[lng]).forEach(function (ns) {\n          var todo = _this11.queuedWrites[lng][ns];\n          if (todo.length) {\n            _this11.write(lng, ns);\n          }\n        });\n      });\n    }\n  }, {\n    key: \"queue\",\n    value: function queue(lng, namespace, key, fallbackValue, callback, options) {\n      pushPath(this.queuedWrites, [lng, namespace], {\n        key: key,\n        fallbackValue: fallbackValue || '',\n        callback: callback,\n        options: options\n      });\n      this.debouncedProcess();\n    }\n  }]);\n  return I18NextLocizeBackend;\n}();\nI18NextLocizeBackend.type = 'backend';\nexport default I18NextLocizeBackend;","map":{"version":3,"names":["_typeof","obj","Symbol","iterator","constructor","prototype","_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","_toPropertyKey","key","_createClass","protoProps","staticProps","arg","_toPrimitive","String","input","hint","prim","toPrimitive","undefined","res","call","Number","defaults","debounce","isMissingOption","interpolate","getPath","setPath","pushPath","defer","request","getDefaults","loadPath","privatePath","getLanguagesPath","addPath","updatePath","referenceLng","crossDomain","setContentTypeJSON","version","private","translatedPercentageThreshold","failLoadingOnEmptyJSON","allowedAddOrUpdateHosts","onSaved","reloadInterval","window","checkForProjectTimeout","storageExpiration","writeDebounce","hasLocalStorageSupport","localStorage","testKey","setItem","removeItem","e","getStorage","setProjectNotExisting","isProjectNotExisting","projectId","concat","Date","now","ret","getItem","document","date","setTime","getTime","expires","toGMTString","name","cookie","err","nameEQ","ca","split","c","charAt","substring","indexOf","getCustomRequestInfo","url","options","payload","headers","authorize","apiKey","Authorization","method","body","handleCustomRequest","opt","info","cb","r","then","data","catch","I18NextLocizeBackend","services","arguments","allOptions","callback","type","init","value","_this","fallbackLng","Array","isArray","defOpt","passedOpt","console","warn","somethingLoaded","storage","pull","hostname","location","isAddOrUpdateAllowed","logger","saveMissing","updateMissing","join","getOptions","opts","languages","queuedWrites","pending","debouncedProcess","process","interval","clearInterval","setInterval","reload","_this2","_ref","backendConnector","languageUtils","currentLanguage","language","toLowerCase","toLoad","append","lng","lngs","toResolveHierarchy","forEach","l","push","preload","ns","read","log","loaded","getLanguages","_this3","deferred","reject","resolve","isMissing","Error","getLanguagesCalls","loadUrl","resourceNotExisting","_clbs","clb","keys","reduce","mem","k","item","isReferenceLanguage","clbs","_this4","translated","hasRegion","supportedLngs","load","checkIfProjectExists","_this5","_ref2","alreadyRequestedCheckIfProjectExists","setTimeout","message","error","namespace","_this6","_ref3","_isMissing","_this7","status","parseErr","JSON","parse","create","fallbackValue","_this8","filter","queue","update","_this9","isUpdate","writePage","missings","missingUrl","updatesUrl","hasMissing","hasUpdates","payloadMissing","payloadUpdate","tDescription","context","text","todo","doneOne","_info","write","_this10","lock","pageSize","m","map","missing","namespaceSaved","amountOfPages","pagesDone","page","splice","_this11"],"sources":["C:/Users/LEO/Desktop/Leo/angular-translate/node_modules/i18next-locize-backend/esm/index.js"],"sourcesContent":["function _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor); } }\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return _typeof(key) === \"symbol\" ? key : String(key); }\nfunction _toPrimitive(input, hint) { if (_typeof(input) !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (_typeof(res) !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\nimport { defaults, debounce, isMissingOption, interpolate, getPath, setPath, pushPath, defer } from './utils.js';\nimport request from './request.js';\nvar getDefaults = function getDefaults() {\n  return {\n    loadPath: 'https://api.locize.app/{{projectId}}/{{version}}/{{lng}}/{{ns}}',\n    privatePath: 'https://api.locize.app/private/{{projectId}}/{{version}}/{{lng}}/{{ns}}',\n    getLanguagesPath: 'https://api.locize.app/languages/{{projectId}}',\n    addPath: 'https://api.locize.app/missing/{{projectId}}/{{version}}/{{lng}}/{{ns}}',\n    updatePath: 'https://api.locize.app/update/{{projectId}}/{{version}}/{{lng}}/{{ns}}',\n    referenceLng: 'en',\n    crossDomain: true,\n    setContentTypeJSON: false,\n    version: 'latest',\n    private: false,\n    translatedPercentageThreshold: 0.9,\n    failLoadingOnEmptyJSON: false,\n    allowedAddOrUpdateHosts: ['localhost'],\n    onSaved: false,\n    reloadInterval: typeof window !== 'undefined' ? false : 60 * 60 * 1000,\n    checkForProjectTimeout: 3 * 1000,\n    storageExpiration: 60 * 60 * 1000,\n    writeDebounce: 5 * 1000\n  };\n};\nvar hasLocalStorageSupport;\ntry {\n  hasLocalStorageSupport = typeof window !== 'undefined' && window.localStorage !== null;\n  var testKey = 'notExistingLocizeProject';\n  window.localStorage.setItem(testKey, 'foo');\n  window.localStorage.removeItem(testKey);\n} catch (e) {\n  hasLocalStorageSupport = false;\n}\nfunction getStorage(storageExpiration) {\n  var setProjectNotExisting = function setProjectNotExisting() {};\n  var isProjectNotExisting = function isProjectNotExisting() {};\n  if (hasLocalStorageSupport) {\n    setProjectNotExisting = function setProjectNotExisting(projectId) {\n      window.localStorage.setItem(\"notExistingLocizeProject_\".concat(projectId), Date.now());\n    };\n    isProjectNotExisting = function isProjectNotExisting(projectId) {\n      var ret = window.localStorage.getItem(\"notExistingLocizeProject_\".concat(projectId));\n      if (!ret) return false;\n      if (Date.now() - ret > storageExpiration) {\n        window.localStorage.removeItem(\"notExistingLocizeProject_\".concat(projectId));\n        return false;\n      }\n      return true;\n    };\n  } else if (typeof document !== 'undefined') {\n    setProjectNotExisting = function setProjectNotExisting(projectId) {\n      var date = new Date();\n      date.setTime(date.getTime() + storageExpiration);\n      var expires = \"; expires=\".concat(date.toGMTString());\n      var name = \"notExistingLocizeProject_\".concat(projectId);\n      try {\n        document.cookie = \"\".concat(name, \"=\").concat(Date.now()).concat(expires, \";path=/\");\n      } catch (err) {}\n    };\n    isProjectNotExisting = function isProjectNotExisting(projectId) {\n      var name = \"notExistingLocizeProject_\".concat(projectId);\n      var nameEQ = \"\".concat(name, \"=\");\n      try {\n        var ca = document.cookie.split(';');\n        for (var i = 0; i < ca.length; i++) {\n          var c = ca[i];\n          while (c.charAt(0) === ' ') {\n            c = c.substring(1, c.length);\n          }\n          if (c.indexOf(nameEQ) === 0) return true;\n        }\n      } catch (err) {}\n      return false;\n    };\n  }\n  return {\n    setProjectNotExisting: setProjectNotExisting,\n    isProjectNotExisting: isProjectNotExisting\n  };\n}\nvar getCustomRequestInfo = function getCustomRequestInfo(url, options, payload) {\n  var headers = {};\n  if (options.authorize && options.apiKey) {\n    headers.Authorization = options.apiKey;\n  }\n  if (payload || options.setContentTypeJSON) {\n    headers['Content-Type'] = 'application/json';\n  }\n  return {\n    method: payload ? 'POST' : 'GET',\n    url: url,\n    headers: headers,\n    body: payload\n  };\n};\nvar handleCustomRequest = function handleCustomRequest(opt, info, cb) {\n  if (opt.request.length === 1) {\n    try {\n      var r = opt.request(info);\n      if (r && typeof r.then === 'function') {\n        r.then(function (data) {\n          return cb(null, data);\n        }).catch(cb);\n      } else {\n        cb(null, r);\n      }\n    } catch (err) {\n      cb(err);\n    }\n    return;\n  }\n  opt.request(info, cb);\n};\nvar I18NextLocizeBackend = function () {\n  function I18NextLocizeBackend(services) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    var allOptions = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    var callback = arguments.length > 3 ? arguments[3] : undefined;\n    _classCallCheck(this, I18NextLocizeBackend);\n    this.services = services;\n    this.options = options;\n    this.allOptions = allOptions;\n    this.type = 'backend';\n    if (services && services.projectId) {\n      this.init(null, services, allOptions, options);\n    } else {\n      this.init(services, options, allOptions, callback);\n    }\n  }\n  _createClass(I18NextLocizeBackend, [{\n    key: \"init\",\n    value: function init(services) {\n      var _this = this;\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var allOptions = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n      var callback = arguments.length > 3 ? arguments[3] : undefined;\n      if (!options.referenceLng && allOptions.fallbackLng && Array.isArray(allOptions.fallbackLng) && allOptions.fallbackLng[0] !== 'dev') {\n        options.referenceLng = allOptions.fallbackLng[0];\n      }\n      this.services = services;\n      var defOpt = getDefaults();\n      var passedOpt = defaults(options, this.options || {});\n      if (passedOpt.reloadInterval && passedOpt.reloadInterval < 5 * 60 * 1000) {\n        console.warn('Your configured reloadInterval option is to low.');\n        passedOpt.reloadInterval = defOpt.reloadInterval;\n      }\n      this.options = defaults(options, this.options || {}, defOpt);\n      this.allOptions = allOptions;\n      this.somethingLoaded = false;\n      this.isProjectNotExisting = false;\n      this.storage = getStorage(this.options.storageExpiration);\n      if (this.options.pull) {\n        console.warn('The pull API was removed use \"private: true\" option instead: https://docs.locize.com/integration/api#fetch-private-namespace-resources');\n      }\n      var hostname = typeof window !== 'undefined' && window.location && window.location.hostname;\n      if (hostname) {\n        this.isAddOrUpdateAllowed = typeof this.options.allowedAddOrUpdateHosts === 'function' ? this.options.allowedAddOrUpdateHosts(hostname) : this.options.allowedAddOrUpdateHosts.indexOf(hostname) > -1;\n        if (services && services.logger && (allOptions.saveMissing || allOptions.updateMissing)) {\n          if (!this.isAddOrUpdateAllowed) {\n            services.logger.warn(typeof this.options.allowedAddOrUpdateHosts === 'function' ? \"locize-backend: will not save or update missings because allowedAddOrUpdateHosts returned false for the host \\\"\".concat(hostname, \"\\\".\") : \"locize-backend: will not save or update missings because the host \\\"\".concat(hostname, \"\\\" was not in the list of allowedAddOrUpdateHosts: \").concat(this.options.allowedAddOrUpdateHosts.join(', '), \" (matches need to be exact).\"));\n          } else if (hostname !== 'localhost') {\n            services.logger.warn(\"locize-backend: you are using the save or update missings feature from this host \\\"\".concat(hostname, \"\\\".\\nMake sure you will not use it in production!\\nhttps://docs.locize.com/guides-tips-and-tricks/going-production\"));\n          }\n        }\n      } else {\n        this.isAddOrUpdateAllowed = true;\n      }\n      if (typeof callback === 'function') {\n        this.getOptions(function (err, opts, languages) {\n          if (err) return callback(err);\n          _this.options.referenceLng = options.referenceLng || opts.referenceLng || _this.options.referenceLng;\n          callback(null, opts, languages);\n        });\n      }\n      this.queuedWrites = {\n        pending: {}\n      };\n      this.debouncedProcess = debounce(this.process, this.options.writeDebounce);\n      if (this.interval) clearInterval(this.interval);\n      if (this.options.reloadInterval && this.options.projectId) {\n        this.interval = setInterval(function () {\n          return _this.reload();\n        }, this.options.reloadInterval);\n      }\n    }\n  }, {\n    key: \"reload\",\n    value: function reload() {\n      var _this2 = this;\n      var _ref = this.services || {\n          logger: console\n        },\n        backendConnector = _ref.backendConnector,\n        languageUtils = _ref.languageUtils,\n        logger = _ref.logger;\n      if (!backendConnector) return;\n      var currentLanguage = backendConnector.language;\n      if (currentLanguage && currentLanguage.toLowerCase() === 'cimode') return;\n      var toLoad = [];\n      var append = function append(lng) {\n        var lngs = languageUtils.toResolveHierarchy(lng);\n        lngs.forEach(function (l) {\n          if (toLoad.indexOf(l) < 0) toLoad.push(l);\n        });\n      };\n      append(currentLanguage);\n      if (this.allOptions.preload) this.allOptions.preload.forEach(function (l) {\n        return append(l);\n      });\n      toLoad.forEach(function (lng) {\n        _this2.allOptions.ns.forEach(function (ns) {\n          backendConnector.read(lng, ns, 'read', null, null, function (err, data) {\n            if (err) logger.warn(\"loading namespace \".concat(ns, \" for language \").concat(lng, \" failed\"), err);\n            if (!err && data) logger.log(\"loaded namespace \".concat(ns, \" for language \").concat(lng), data);\n            backendConnector.loaded(\"\".concat(lng, \"|\").concat(ns), err, data);\n          });\n        });\n      });\n    }\n  }, {\n    key: \"getLanguages\",\n    value: function getLanguages(callback) {\n      var _this3 = this;\n      var deferred;\n      if (!callback) {\n        deferred = defer();\n        callback = function callback(err, ret) {\n          if (err) return deferred.reject(err);\n          deferred.resolve(ret);\n        };\n      }\n      var isMissing = isMissingOption(this.options, ['projectId']);\n      if (isMissing) return callback(new Error(isMissing));\n      var url = interpolate(this.options.getLanguagesPath, {\n        projectId: this.options.projectId\n      });\n      if (!this.isProjectNotExisting && this.storage.isProjectNotExisting(this.options.projectId)) {\n        this.isProjectNotExisting = true;\n      }\n      if (this.isProjectNotExisting) return callback(new Error(\"locize project \".concat(this.options.projectId, \" does not exist!\")));\n      this.getLanguagesCalls = this.getLanguagesCalls || [];\n      this.getLanguagesCalls.push(callback);\n      if (this.getLanguagesCalls.length > 1) return;\n      this.loadUrl({}, url, function (err, ret, info) {\n        if (!_this3.somethingLoaded && info && info.resourceNotExisting) {\n          _this3.isProjectNotExisting = true;\n          _this3.storage.setProjectNotExisting(_this3.options.projectId);\n          var e = new Error(\"locize project \".concat(_this3.options.projectId, \" does not exist!\"));\n          var _clbs = _this3.getLanguagesCalls;\n          _this3.getLanguagesCalls = [];\n          return _clbs.forEach(function (clb) {\n            return clb(e);\n          });\n        }\n        if (ret) {\n          var referenceLng = Object.keys(ret).reduce(function (mem, k) {\n            var item = ret[k];\n            if (item.isReferenceLanguage) mem = k;\n            return mem;\n          }, '');\n          if (referenceLng && _this3.options.referenceLng !== referenceLng) {\n            _this3.options.referenceLng = referenceLng;\n          }\n        }\n        _this3.somethingLoaded = true;\n        var clbs = _this3.getLanguagesCalls;\n        _this3.getLanguagesCalls = [];\n        clbs.forEach(function (clb) {\n          return clb(err, ret);\n        });\n      });\n      return deferred;\n    }\n  }, {\n    key: \"getOptions\",\n    value: function getOptions(callback) {\n      var _this4 = this;\n      var deferred;\n      if (!callback) {\n        deferred = defer();\n        callback = function callback(err, ret) {\n          if (err) return deferred.reject(err);\n          deferred.resolve(ret);\n        };\n      }\n      this.getLanguages(function (err, data) {\n        if (err) return callback(err);\n        var keys = Object.keys(data);\n        if (!keys.length) {\n          return callback(new Error('was unable to load languages via API'));\n        }\n        var lngs = keys.reduce(function (mem, k) {\n          var item = data[k];\n          if (item.translated[_this4.options.version] && item.translated[_this4.options.version] >= _this4.options.translatedPercentageThreshold) {\n            mem.push(k);\n          }\n          return mem;\n        }, []);\n        var hasRegion = keys.reduce(function (mem, k) {\n          if (k.indexOf('-') > -1) return true;\n          return mem;\n        }, false);\n        callback(null, {\n          fallbackLng: _this4.options.referenceLng,\n          referenceLng: _this4.options.referenceLng,\n          supportedLngs: lngs,\n          load: hasRegion ? 'all' : 'languageOnly'\n        }, data);\n      });\n      return deferred;\n    }\n  }, {\n    key: \"checkIfProjectExists\",\n    value: function checkIfProjectExists(callback) {\n      var _this5 = this;\n      var _ref2 = this.services || {\n          logger: console\n        },\n        logger = _ref2.logger;\n      if (this.somethingLoaded) {\n        if (callback) callback(null);\n        return;\n      }\n      if (this.alreadyRequestedCheckIfProjectExists) {\n        setTimeout(function () {\n          return _this5.checkIfProjectExists(callback);\n        }, this.options.checkForProjectTimeout);\n        return;\n      }\n      this.alreadyRequestedCheckIfProjectExists = true;\n      this.getLanguages(function (err) {\n        if (err && err.message && err.message.indexOf('does not exist') > 0) {\n          if (logger) logger.error(err.message);\n        }\n        if (callback) callback(err);\n      });\n    }\n  }, {\n    key: \"read\",\n    value: function read(language, namespace, callback) {\n      var _this6 = this;\n      var _ref3 = this.services || {\n          logger: console\n        },\n        logger = _ref3.logger;\n      var url;\n      var options = {};\n      if (this.options.private) {\n        var isMissing = isMissingOption(this.options, ['projectId', 'version', 'apiKey']);\n        if (isMissing) return callback(new Error(isMissing), false);\n        url = interpolate(this.options.privatePath, {\n          lng: language,\n          ns: namespace,\n          projectId: this.options.projectId,\n          version: this.options.version\n        });\n        options = {\n          authorize: true\n        };\n      } else {\n        var _isMissing = isMissingOption(this.options, ['projectId', 'version']);\n        if (_isMissing) return callback(new Error(_isMissing), false);\n        url = interpolate(this.options.loadPath, {\n          lng: language,\n          ns: namespace,\n          projectId: this.options.projectId,\n          version: this.options.version\n        });\n      }\n      if (!this.isProjectNotExisting && this.storage.isProjectNotExisting(this.options.projectId)) {\n        this.isProjectNotExisting = true;\n      }\n      if (this.isProjectNotExisting) {\n        var err = new Error(\"locize project \".concat(this.options.projectId, \" does not exist!\"));\n        if (logger) logger.error(err.message);\n        if (callback) callback(err);\n        return;\n      }\n      this.loadUrl(options, url, function (err, ret, info) {\n        if (!_this6.somethingLoaded) {\n          if (info && info.resourceNotExisting) {\n            setTimeout(function () {\n              return _this6.checkIfProjectExists();\n            }, _this6.options.checkForProjectTimeout);\n          } else {\n            _this6.somethingLoaded = true;\n          }\n        }\n        callback(err, ret);\n      });\n    }\n  }, {\n    key: \"loadUrl\",\n    value: function loadUrl(options, url, payload, callback) {\n      var _this7 = this;\n      options = defaults(options, this.options);\n      if (typeof payload === 'function') {\n        callback = payload;\n        payload = undefined;\n      }\n      callback = callback || function () {};\n      var clb = function clb(err, res) {\n        var resourceNotExisting = res && res.resourceNotExisting;\n        if (res && (res.status === 408 || res.status === 400)) {\n          return callback('failed loading ' + url, true, {\n            resourceNotExisting: resourceNotExisting\n          });\n        }\n        if (res && (res.status >= 500 && res.status < 600 || !res.status)) {\n          return callback('failed loading ' + url, true, {\n            resourceNotExisting: resourceNotExisting\n          });\n        }\n        if (res && res.status >= 400 && res.status < 500) {\n          return callback('failed loading ' + url, false, {\n            resourceNotExisting: resourceNotExisting\n          });\n        }\n        if (!res && err && err.message && err.message.indexOf('Failed to fetch') > -1) {\n          return callback('failed loading ' + url, true, {\n            resourceNotExisting: resourceNotExisting\n          });\n        }\n        if (err) return callback(err, false);\n        var ret, parseErr;\n        try {\n          if (typeof res.data === 'string') {\n            ret = JSON.parse(res.data);\n          } else {\n            ret = res.data;\n          }\n        } catch (e) {\n          parseErr = 'failed parsing ' + url + ' to json';\n        }\n        if (parseErr) return callback(parseErr, false);\n        if (_this7.options.failLoadingOnEmptyJSON && !Object.keys(ret).length) {\n          return callback('loaded result empty for ' + url, false, {\n            resourceNotExisting: resourceNotExisting\n          });\n        }\n        callback(null, ret, {\n          resourceNotExisting: resourceNotExisting\n        });\n      };\n      if (!this.options.request || url.indexOf(\"/languages/\".concat(options.projectId)) > 0) return request(options, url, payload, clb);\n      var info = getCustomRequestInfo(url, options, payload);\n      handleCustomRequest(this.options, info, clb);\n    }\n  }, {\n    key: \"create\",\n    value: function create(languages, namespace, key, fallbackValue, callback, options) {\n      var _this8 = this;\n      if (typeof callback !== 'function') callback = function callback() {};\n      this.checkIfProjectExists(function (err) {\n        if (err) return callback(err);\n        var isMissing = isMissingOption(_this8.options, ['projectId', 'version', 'apiKey', 'referenceLng']);\n        if (isMissing) return callback(new Error(isMissing));\n        if (!_this8.isAddOrUpdateAllowed) {\n          return callback('host is not allowed to create key.');\n        }\n        if (typeof languages === 'string') languages = [languages];\n        if (languages.filter(function (l) {\n          return l === _this8.options.referenceLng;\n        }).length < 1) {\n          _this8.services && _this8.services.logger && _this8.services.logger.warn(\"locize-backend: will not save missings because the reference language \\\"\".concat(_this8.options.referenceLng, \"\\\" was not in the list of to save languages: \").concat(languages.join(', '), \" (open your site in the reference language to save missings).\"));\n        }\n        languages.forEach(function (lng) {\n          if (lng === _this8.options.referenceLng) {\n            _this8.queue.call(_this8, _this8.options.referenceLng, namespace, key, fallbackValue, callback, options);\n          }\n        });\n      });\n    }\n  }, {\n    key: \"update\",\n    value: function update(languages, namespace, key, fallbackValue, callback, options) {\n      var _this9 = this;\n      if (typeof callback !== 'function') callback = function callback() {};\n      this.checkIfProjectExists(function (err) {\n        if (err) return callback(err);\n        var isMissing = isMissingOption(_this9.options, ['projectId', 'version', 'apiKey', 'referenceLng']);\n        if (isMissing) return callback(new Error(isMissing));\n        if (!_this9.isAddOrUpdateAllowed) {\n          return callback('host is not allowed to update key.');\n        }\n        if (!options) options = {};\n        if (typeof languages === 'string') languages = [languages];\n        options.isUpdate = true;\n        languages.forEach(function (lng) {\n          if (lng === _this9.options.referenceLng) {\n            _this9.queue.call(_this9, _this9.options.referenceLng, namespace, key, fallbackValue, callback, options);\n          }\n        });\n      });\n    }\n  }, {\n    key: \"writePage\",\n    value: function writePage(lng, namespace, missings, callback) {\n      var missingUrl = interpolate(this.options.addPath, {\n        lng: lng,\n        ns: namespace,\n        projectId: this.options.projectId,\n        version: this.options.version\n      });\n      var updatesUrl = interpolate(this.options.updatePath, {\n        lng: lng,\n        ns: namespace,\n        projectId: this.options.projectId,\n        version: this.options.version\n      });\n      var hasMissing = false;\n      var hasUpdates = false;\n      var payloadMissing = {};\n      var payloadUpdate = {};\n      missings.forEach(function (item) {\n        var value = item.options && item.options.tDescription ? {\n          value: item.fallbackValue || '',\n          context: {\n            text: item.options.tDescription\n          }\n        } : item.fallbackValue || '';\n        if (item.options && item.options.isUpdate) {\n          if (!hasUpdates) hasUpdates = true;\n          payloadUpdate[item.key] = value;\n        } else {\n          if (!hasMissing) hasMissing = true;\n          payloadMissing[item.key] = value;\n        }\n      });\n      var todo = 0;\n      if (hasMissing) todo++;\n      if (hasUpdates) todo++;\n      var doneOne = function doneOne(err) {\n        todo--;\n        if (!todo) callback(err);\n      };\n      if (!todo) doneOne();\n      if (hasMissing) {\n        if (!this.options.request) {\n          request(defaults({\n            authorize: true\n          }, this.options), missingUrl, payloadMissing, doneOne);\n        } else {\n          var info = getCustomRequestInfo(missingUrl, defaults({\n            authorize: true\n          }, this.options), payloadMissing);\n          handleCustomRequest(this.options, info, doneOne);\n        }\n      }\n      if (hasUpdates) {\n        if (!this.options.request) {\n          request(defaults({\n            authorize: true\n          }, this.options), updatesUrl, payloadUpdate, doneOne);\n        } else {\n          var _info = getCustomRequestInfo(updatesUrl, defaults({\n            authorize: true\n          }, this.options), payloadUpdate);\n          handleCustomRequest(this.options, _info, doneOne);\n        }\n      }\n    }\n  }, {\n    key: \"write\",\n    value: function write(lng, namespace) {\n      var _this10 = this;\n      var lock = getPath(this.queuedWrites, ['locks', lng, namespace]);\n      if (lock) return;\n      var missings = getPath(this.queuedWrites, [lng, namespace]);\n      setPath(this.queuedWrites, [lng, namespace], []);\n      var pageSize = 1000;\n      var clbs = missings.filter(function (m) {\n        return m.callback;\n      }).map(function (missing) {\n        return missing.callback;\n      });\n      if (missings.length) {\n        (function () {\n          setPath(_this10.queuedWrites, ['locks', lng, namespace], true);\n          var namespaceSaved = function namespaceSaved() {\n            setPath(_this10.queuedWrites, ['locks', lng, namespace], false);\n            clbs.forEach(function (clb) {\n              return clb();\n            });\n            if (_this10.options.onSaved) _this10.options.onSaved(lng, namespace);\n            _this10.debouncedProcess(lng, namespace);\n          };\n          var amountOfPages = missings.length / pageSize;\n          var pagesDone = 0;\n          var page = missings.splice(0, pageSize);\n          _this10.writePage(lng, namespace, page, function () {\n            pagesDone++;\n            if (pagesDone >= amountOfPages) namespaceSaved();\n          });\n          while (page.length === pageSize) {\n            page = missings.splice(0, pageSize);\n            if (page.length) {\n              _this10.writePage(lng, namespace, page, function () {\n                pagesDone++;\n                if (pagesDone >= amountOfPages) namespaceSaved();\n              });\n            }\n          }\n        })();\n      }\n    }\n  }, {\n    key: \"process\",\n    value: function process() {\n      var _this11 = this;\n      Object.keys(this.queuedWrites).forEach(function (lng) {\n        if (lng === 'locks') return;\n        Object.keys(_this11.queuedWrites[lng]).forEach(function (ns) {\n          var todo = _this11.queuedWrites[lng][ns];\n          if (todo.length) {\n            _this11.write(lng, ns);\n          }\n        });\n      });\n    }\n  }, {\n    key: \"queue\",\n    value: function queue(lng, namespace, key, fallbackValue, callback, options) {\n      pushPath(this.queuedWrites, [lng, namespace], {\n        key: key,\n        fallbackValue: fallbackValue || '',\n        callback: callback,\n        options: options\n      });\n      this.debouncedProcess();\n    }\n  }]);\n  return I18NextLocizeBackend;\n}();\nI18NextLocizeBackend.type = 'backend';\nexport default I18NextLocizeBackend;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}