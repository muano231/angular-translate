import { Inject, Injectable, Pipe } from '@angular/core';
import { I18NEXT_NAMESPACE, I18NEXT_SCOPE, I18NEXT_SERVICE } from './I18NEXT_TOKENS';
import * as i0 from "@angular/core";
export class I18NextPipe {
    constructor(translateI18Next, ns, scope) {
        this.translateI18Next = translateI18Next;
        this.ns = ns;
        this.scope = scope;
    }
    transform(key, options) {
        options = this.prepareOptions(options);
        let i18nOpts = this.translateI18Next.options;
        if (options.prependScope === undefined || options.prependScope === true) {
            if (this.scope) {
                key = this.prependScope(key, this.scope, i18nOpts.keySeparator, i18nOpts.nsSeparator);
            }
        }
        if (options.prependNamespace === undefined ||
            options.prependNamespace === true) {
            if (this.ns) {
                key = this.prependNamespace(key, this.ns, i18nOpts.nsSeparator);
            }
        }
        let result = this.translateI18Next.t(key, options);
        if (options.format) {
            if (result) {
                result = this.translateI18Next.format(result, options.format, this.translateI18Next.language);
            }
        }
        return result ?? '';
    }
    prependScope(key, scope, keySeparator, nsSeparator) {
        const nsSep = nsSeparator || '';
        const keySep = keySeparator || '';
        if (typeof key === 'string') {
            key = [key];
        }
        if (typeof scope === 'string') {
            scope = [scope];
        }
        let keysWithScope = [];
        for (let i = 0; i < key.length; i++) {
            const k = key[i];
            if (!this.keyContainsNsSeparator(k, nsSep)) {
                // Do not set scope, if key contains a namespace
                keysWithScope.push(...scope.map((sc) => this.joinStrings(keySep, sc, k)));
            }
            keysWithScope.push(k);
        }
        return keysWithScope;
    }
    prependNamespace(key, ns, nsSeparator) {
        const nsSep = nsSeparator || '';
        if (typeof key === 'string') {
            key = [key];
        }
        if (typeof ns === 'string') {
            ns = [ns];
        }
        let keysWithNamespace = [];
        for (let i = 0; i < key.length; i++) {
            const k = key[i];
            if (!this.keyContainsNsSeparator(k, nsSep)) {
                // Do not set namespace, if key contains a namespace
                keysWithNamespace.push(...ns.map((n) => this.joinStrings(nsSep, n, k)));
            }
            keysWithNamespace.push(k);
        }
        return keysWithNamespace;
    }
    joinStrings(separator, ...str) {
        return [...str].join(separator);
    }
    keyContainsNsSeparator(key, nsSeparator) {
        return key.indexOf(nsSeparator) !== -1;
    }
    prepareOptions(options) {
        options = options || {};
        if (options.context != null)
            options.context = options.context.toString();
        return options;
    }
}
I18NextPipe.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.0.4", ngImport: i0, type: I18NextPipe, deps: [{ token: I18NEXT_SERVICE }, { token: I18NEXT_NAMESPACE }, { token: I18NEXT_SCOPE }], target: i0.ɵɵFactoryTarget.Pipe });
I18NextPipe.ɵpipe = i0.ɵɵngDeclarePipe({ minVersion: "14.0.0", version: "15.0.4", ngImport: i0, type: I18NextPipe, name: "i18next" });
I18NextPipe.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "15.0.4", ngImport: i0, type: I18NextPipe });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.0.4", ngImport: i0, type: I18NextPipe, decorators: [{
            type: Injectable
        }, {
            type: Pipe,
            args: [{
                    name: 'i18next',
                }]
        }], ctorParameters: function () { return [{ type: undefined, decorators: [{
                    type: Inject,
                    args: [I18NEXT_SERVICE]
                }] }, { type: undefined, decorators: [{
                    type: Inject,
                    args: [I18NEXT_NAMESPACE]
                }] }, { type: undefined, decorators: [{
                    type: Inject,
                    args: [I18NEXT_SCOPE]
                }] }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSTE4TmV4dFBpcGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvbGliL0kxOE5leHRQaXBlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFLElBQUksRUFBaUIsTUFBTSxlQUFlLENBQUM7QUFFeEUsT0FBTyxFQUNMLGlCQUFpQixFQUNqQixhQUFhLEVBQ2IsZUFBZSxFQUNoQixNQUFNLGtCQUFrQixDQUFDOztBQU8xQixNQUFNLE9BQU8sV0FBVztJQUN0QixZQUNxQyxnQkFBcUMsRUFDbkMsRUFBcUIsRUFDekIsS0FBd0I7UUFGdEIscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFxQjtRQUNuQyxPQUFFLEdBQUYsRUFBRSxDQUFtQjtRQUN6QixVQUFLLEdBQUwsS0FBSyxDQUFtQjtJQUN4RCxDQUFDO0lBRUcsU0FBUyxDQUFDLEdBQXNCLEVBQUUsT0FBcUI7UUFDNUQsT0FBTyxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLENBQUM7UUFFdkMsSUFBSSxRQUFRLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDLE9BQU8sQ0FBQztRQUM3QyxJQUFJLE9BQU8sQ0FBQyxZQUFZLEtBQUssU0FBUyxJQUFJLE9BQU8sQ0FBQyxZQUFZLEtBQUssSUFBSSxFQUFFO1lBQ3ZFLElBQUksSUFBSSxDQUFDLEtBQUssRUFBRTtnQkFDZCxHQUFHLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FDckIsR0FBRyxFQUNILElBQUksQ0FBQyxLQUFLLEVBQ1YsUUFBUSxDQUFDLFlBQVksRUFDckIsUUFBUSxDQUFDLFdBQVcsQ0FDckIsQ0FBQzthQUNIO1NBQ0Y7UUFDRCxJQUNFLE9BQU8sQ0FBQyxnQkFBZ0IsS0FBSyxTQUFTO1lBQ3RDLE9BQU8sQ0FBQyxnQkFBZ0IsS0FBSyxJQUFJLEVBQ2pDO1lBQ0EsSUFBSSxJQUFJLENBQUMsRUFBRSxFQUFFO2dCQUNYLEdBQUcsR0FBRyxJQUFJ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Q0FBQztTQUMzQjtRQUNELE9BQU8saUJBQWlCLENBQUM7SUFDM0IsQ0FBQztJQUVPLFdBQVcsQ0FBQyxTQUFpQixFQUFFLEdBQUcsR0FBYTtRQUNyRCxPQUFPLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDbEMsQ0FBQztJQUVPLHNCQUFzQixDQUFDLEdBQVcsRUFBRSxXQUFtQjtRQUM3RCxPQUFPLEdBQUcsQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7SUFDekMsQ0FBQztJQUVPLGNBQWMsQ0FBQyxPQUFxQjtRQUMxQyxPQUFPLEdBQUcsT0FBTyxJQUFJLEVBQUUsQ0FBQztRQUN4QixJQUFJLE9BQU8sQ0FBQyxPQUFPLElBQUksSUFBSTtZQUFFLE9BQU8sQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUMxRSxPQUFPLE9BQU8sQ0FBQztJQUNqQixDQUFDOzt3R0E1R1UsV0FBVyxrQkFFWixlQUFlLGFBQ2YsaUJBQWlCLGFBQ2pCLGFBQWE7c0dBSlosV0FBVzs0R0FBWCxXQUFXOzJGQUFYLFdBQVc7a0JBSnZCLFVBQVU7O2tCQUNWLElBQUk7bUJBQUM7b0JBQ0osSUFBSSxFQUFFLFNBQVM7aUJBQ2hCOzswQkFHSSxNQUFNOzJCQUFDLGVBQWU7OzBCQUN0QixNQUFNOzJCQUFDLGlCQUFpQjs7MEJBQ3hCLE1BQU07MkJBQUMsYUFBYSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdCwgSW5qZWN0YWJsZSwgUGlwZSwgUGlwZVRyYW5zZm9ybSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5cclxuaW1wb3J0IHtcclxuICBJMThORVhUX05BTUVTUEFDRSxcclxuICBJMThORVhUX1NDT1BFLFxyXG4gIEkxOE5FWFRfU0VSVklDRVxyXG59IGZyb20gJy4vSTE4TkVYVF9UT0tFTlMnO1xyXG5pbXBvcnQgeyBJVHJhbnNsYXRpb25TZXJ2aWNlIH0gZnJvbSAnLi9JVHJhbnNsYXRpb25TZXJ2aWNlJztcclxuaW1wb3J0IHsgUGlwZU9wdGlvbnMgfSBmcm9tICcuL21vZGVscyc7XHJcbkBJbmplY3RhYmxlKClcclxuQFBpcGUoe1xyXG4gIG5hbWU6ICdpMThuZXh0JyxcclxufSlcclxuZXhwb3J0IGNsYXNzIEkxOE5leHRQaXBlIGltcGxlbWVudHMgUGlwZVRyYW5zZm9ybSB7XHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBASW5qZWN0KEkxOE5FWFRfU0VSVklDRSkgcHJvdGVjdGVkIHRyYW5zbGF0ZUkxOE5leHQ6IElUcmFuc2xhdGlvblNlcnZpY2UsXHJcbiAgICBASW5qZWN0KEkxOE5FWFRfTkFNRVNQQUNFKSBwcm90ZWN0ZWQgbnM6IHN0cmluZyB8IHN0cmluZ1tdLFxyXG4gICAgQEluamVjdChJMThORVhUX1NDT1BFKSBwcm90ZWN0ZWQgc2NvcGU6IHN0cmluZyB8IHN0cmluZ1tdXHJcbiAgKSB7fVxyXG5cclxuICBwdWJsaWMgdHJhbnNmb3JtKGtleTogc3RyaW5nIHwgc3RyaW5nW10sIG9wdGlvbnM/OiBQaXBlT3B0aW9ucyk6IHN0cmluZyB7XHJcbiAgICBvcHRpb25zID0gdGhpcy5wcmVwYXJlT3B0aW9ucyhvcHRpb25zKTtcclxuXHJcbiAgICBsZXQgaTE4bk9wdHMgPSB0aGlzLnRyYW5zbGF0ZUkxOE5leHQub3B0aW9ucztcclxuICAgIGlmIChvcHRpb25zLnByZXBlbmRTY29wZSA9PT0gdW5kZWZpbmVkIHx8IG9wdGlvbnMucHJlcGVuZFNjb3BlID09PSB0cnVlKSB7XHJcbiAgICAgIGlmICh0aGlzLnNjb3BlKSB7XHJcbiAgICAgICAga2V5ID0gdGhpcy5wcmVwZW5kU2NvcGUoXHJcbiAgICAgICAgICBrZXksXHJcbiAgICAgICAgICB0aGlzLnNjb3BlLFxyXG4gICAgICAgICAgaTE4bk9wdHMua2V5U2VwYXJhdG9yLFxyXG4gICAgICAgICAgaTE4bk9wdHMubnNTZXBhcmF0b3JcclxuICAgICAgICApO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAoXHJcbiAgICAgIG9wdGlvbnMucHJlcGVuZE5hbWVzcGFjZSA9PT0gdW5kZWZpbmVkIHx8XHJcbiAgICAgIG9wdGlvbnMucHJlcGVuZE5hbWVzcGFjZSA9PT0gdHJ1ZVxyXG4gICAgKSB7XHJcbiAgICAgIGlmICh0aGlzLm5zKSB7XHJcbiAgICAgICAga2V5ID0gdGhpcy5wcmVwZW5kTmFtZXNwYWNlKGtleSwgdGhpcy5ucywgaTE4bk9wdHMubnNTZXBhcmF0b3IpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IHJlc3VsdCA9IHRoaXMudHJhbnNsYXRlSTE4TmV4dC50KGtleSwgb3B0aW9ucyk7XHJcblxyXG4gICAgaWYgKG9wdGlvbnMuZm9ybWF0KSB7XHJcbiAgICAgIGlmIChyZXN1bHQpIHtcclxuICAgICAgICByZXN1bHQgPSB0aGlzLnRyYW5zbGF0ZUkxOE5leHQuZm9ybWF0KFxyXG4gICAgICAgICAgcmVzdWx0LFxyXG4gICAgICAgICAgb3B0aW9ucy5mb3JtYXQsXHJcbiAgICAgICAgICB0aGlzLnRyYW5zbGF0ZUkxOE5leHQubGFuZ3VhZ2VcclxuICAgICAgICApO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcmVzdWx0ID8/ICcnO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBwcmVwZW5kU2NvcGUoXHJcbiAgICBrZXk6IHN0cmluZyB8IHN0cmluZ1tdLFxyXG4gICAgc2NvcGU6IHN0cmluZyB8IHN0cmluZ1tdLFxyXG4gICAga2V5U2VwYXJhdG9yOiBzdHJpbmcgfCBmYWxzZSB8IHVuZGVmaW5lZCxcclxuICAgIG5zU2VwYXJhdG9yOiBzdHJpbmcgfCBmYWxzZSB8IHVuZGVmaW5lZFxyXG4gICk6IHN0cmluZ1tdIHtcclxuICAgIGNvbnN0IG5zU2VwID0gbnNTZXBhcmF0b3IgfHwgJyc7XHJcbiAgICBjb25zdCBrZXlTZXAgPSBrZXlTZXBhcmF0b3IgfHwgJyc7XHJcbiAgICBpZiAodHlwZW9mIGtleSA9PT0gJ3N0cmluZycpIHtcclxuICAgICAga2V5ID0gW2tleV07XHJcbiAgICB9XHJcbiAgICBpZiAodHlwZW9mIHNjb3BlID09PSAnc3RyaW5nJykge1xyXG4gICAgICBzY29wZSA9IFtzY29wZV07XHJcbiAgICB9XHJcbiAgICBsZXQga2V5c1dpdGhTY29wZSA9IFtdO1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBrZXkubGVuZ3RoOyBpKyspIHtcclxuICAgICAgY29uc3QgayA9IGtleVtpXTtcclxuICAgICAgaWYgKCF0aGlzLmtleUNvbnRhaW5zTnNTZXBhcmF0b3IoaywgbnNTZXApKSB7XHJcbiAgICAgICAgLy8gRG8gbm90IHNldCBzY29wZSwgaWYga2V5IGNvbnRhaW5zIGEgbmFtZXNwYWNlXHJcbiAgICAgICAga2V5c1dpdGhTY29wZS5wdXNoKFxyXG4gICAgICAgICAgLi4uc2NvcGUubWFwKChzYykgPT4gdGhpcy5qb2luU3RyaW5ncyhrZXlTZXAsIHNjLCBrKSlcclxuICAgICAgICApO1xyXG4gICAgICB9XHJcbiAgICAgIGtleXNXaXRoU2NvcGUucHVzaChrKTtcclxuICAgIH1cclxuICAgIHJldHVybiBrZXlzV2l0aFNjb3BlO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBwcmVwZW5kTmFtZXNwYWNlKFxyXG4gICAga2V5OiBzdHJpbmcgfCBzdHJpbmdbXSxcclxuICAgIG5zOiBzdHJpbmcgfCBzdHJpbmdbXSxcclxuICAgIG5zU2VwYXJhdG9yOiBzdHJpbmcgfCBmYWxzZSB8IHVuZGVmaW5lZFxyXG4gICk6IHN0cmluZ1tdIHtcclxuICAgIGNvbnN0IG5zU2VwID0gbnNTZXBhcmF0b3IgfHwgJyc7XHJcbiAgICBpZiAodHlwZW9mIGtleSA9PT0gJ3N0cmluZycpIHtcclxuICAgICAga2V5ID0gW2tleV07XHJcbiAgICB9XHJcbiAgICBpZiAodHlwZW9mIG5zID09PSAnc3RyaW5nJykge1xyXG4gICAgICBucyA9IFtuc107XHJcbiAgICB9XHJcbiAgICBsZXQga2V5c1dpdGhOYW1lc3BhY2UgPSBbXTtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwga2V5Lmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgIGNvbnN0IGsgPSBrZXlbaV07XHJcbiAgICAgIGlmICghdGhpcy5rZXlDb250YWluc05zU2VwYXJhdG9yKGssIG5zU2VwKSkge1xyXG4gICAgICAgIC8vIERvIG5vdCBzZXQgbmFtZXNwYWNlLCBpZiBrZXkgY29udGFpbnMgYSBuYW1lc3BhY2VcclxuICAgICAgICBrZXlzV2l0aE5hbWVzcGFjZS5wdXNoKC4uLm5zLm1hcCgobikgPT4gdGhpcy5qb2luU3RyaW5ncyhuc1NlcCwgbiwgaykpKTtcclxuICAgICAgfVxyXG4gICAgICBrZXlzV2l0aE5hbWVzcGFjZS5wdXNoKGspO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGtleXNXaXRoTmFtZXNwYWNlO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBqb2luU3RyaW5ncyhzZXBhcmF0b3I6IHN0cmluZywgLi4uc3RyOiBzdHJpbmdbXSkge1xyXG4gICAgcmV0dXJuIFsuLi5zdHJdLmpvaW4oc2VwYXJhdG9yKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUga2V5Q29udGFpbnNOc1NlcGFyYXRvcihrZXk6IHN0cmluZywgbnNTZXBhcmF0b3I6IHN0cmluZykge1xyXG4gICAgcmV0dXJuIGtleS5pbmRleE9mKG5zU2VwYXJhdG9yKSAhPT0gLTE7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHByZXBhcmVPcHRpb25zKG9wdGlvbnM/OiBQaXBlT3B0aW9ucyk6IFBpcGVPcHRpb25zIHtcclxuICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xyXG4gICAgaWYgKG9wdGlvbnMuY29udGV4dCAhPSBudWxsKSBvcHRpb25zLmNvbnRleHQgPSBvcHRpb25zLmNvbnRleHQudG9TdHJpbmcoKTtcclxuICAgIHJldHVybiBvcHRpb25zO1xyXG4gIH1cclxufVxyXG4iXX0=