import { Inject, Injectable, Optional } from '@angular/core';
import * as i18n from 'i18next';
import { I18NEXT_ERROR_HANDLING_STRATEGY, I18NEXT_INSTANCE } from './I18NEXT_TOKENS';
import { I18NextEvents } from './I18NextEvents';
import * as i0 from "@angular/core";
const i18nextGlobal = i18n.default;
export class I18NextService {
    constructor(errorHandlingStrategy, i18nextInstance) {
        this.errorHandlingStrategy = errorHandlingStrategy;
        this.events = new I18NextEvents();
        this.i18next = i18nextInstance ?? i18nextGlobal;
    }
    get language() {
        return this.i18next.language;
    }
    get languages() {
        return this.i18next.languages;
    }
    get options() {
        return this.i18next.options;
    }
    get modules() {
        return this.i18next.modules;
    }
    get services() {
        return this.i18next.services;
    }
    get store() {
        return this.i18next.store;
    }
    get resolvedLanguage() {
        return this.i18next.resolvedLanguage;
    }
    get isInitialized() {
        return this.i18next.isInitialized;
    }
    t(key, defaultValueOrOptions, options) {
        const hasDefault = !!defaultValueOrOptions && typeof defaultValueOrOptions === 'string';
        this.i18next.t.bind(this.i18next);
        if (hasDefault) {
            return this.i18next.t(key, defaultValueOrOptions, options);
        }
        else {
            return this.i18next.t(key, defaultValueOrOptions);
        }
    }
    use(module) {
        this.i18next.use.call(this.i18next, module);
        return this;
    }
    init(options) {
        this.subscribeEvents();
        return new Promise((resolve, reject) => {
            this.i18next.init.call(this.i18next, Object.assign({}, options ?? {}), this.errorHandlingStrategy.handle(resolve, reject));
        });
    }
    format(value, format, lng) {
        return this.i18next.format.call(this.i18next, value, format, lng, {});
    }
    exists(key, options) {
        return this.i18next.exists.call(this.i18next, key, options);
    }
    getFixedT(lng, ns, keyPrefix) {
        return this.i18next.getFixedT.call(this.i18next, lng, ns, keyPrefix);
    }
    setDefaultNamespace(ns) {
        this.i18next.setDefaultNamespace.call(this.i18next, ns);
    }
    dir(lng) {
        return this.i18next.dir.call(this.i18next, lng);
    }
    changeLanguage(lng) {
        return new Promise((resolve, reject) => {
            return this.i18next.changeLanguage.call(this.i18next, lng, this.errorHandlingStrategy.handle(resolve, reject));
        });
    }
    loadNamespaces(namespaces) {
        return new Promise((resolve, reject) => {
            this.i18next.loadNamespaces.call(this.i18next, namespaces, this.errorHandlingStrategy.handle(resolve, reject));
        });
    }
    loadLanguages(lngs) {
        return new Promise((resolve, reject) => {
            this.i18next.loadLanguages.call(this.i18next, lngs, this.errorHandlingStrategy.handle(resolve, reject));
        });
    }
    //#region resource handling
    loadResources(callback) {
        this.i18next.loadResources.call(this.i18next, callback);
    }
    getDataByLanguage(lng) {
        return this.i18next.getDataByLanguage.call(this.i18next, lng);
    }
    async reloadResources(...params) {
        await this.i18next.reloadResources.apply(this.i18next, params);
    }
    getResource(lng, ns, key, options) {
        return this.i18next.getResource.call(this.i18next, lng, ns, key, options);
    }
    addResource(lng, ns, key, value, options) {
        return this.i18next.addResource.call(this.i18next, lng, ns, key, value, options);
    }
    addResources(lng, ns, resources) {
        return this.i18next.addResources.call(this.i18next, lng, ns, resources);
    }
    addResourceBundle(lng, ns, resources, deep, overwrite) {
        return this.i18next.addResourceBundle.call(this.i18next, lng, ns, resources, deep, overwrite);
    }
    hasResourceBundle(lng, ns) {
        return this.i18next.hasResourceBundle.call(this.i18next, lng, ns);
    }
    getResourceBundle(lng, ns) {
        return this.i18next.getResourceBundle.call(this.i18next, lng, ns);
    }
    removeResourceBundle(lng, ns) {
        return this.i18next.removeResourceBundle.call(this.i18next, lng, ns);
    }
    //#endregion
    subscribeEvents() {
        this.i18next.on.call(this.i18next, 'initialized', (options) => {
            this.events.initialized.next(options);
        });
        this.i18next.on.call(this.i18next, 'loaded', (loaded) => this.events.loaded.next(loaded));
        this.i18next.on.call(this.i18next, 'failedLoading', (lng, ns, msg) => this.events.failedLoading.next({ lng, ns, msg }));
        this.i18next.on.call(this.i18next, 'languageChanged', (lng) => {
            this.events.languageChanged.next(lng);
        });
        this.i18next.on.call(this.i18next, 'missingKey', (lngs, namespace, key, res) => this.events.missingKey.next({ lngs, namespace, key, res }));
        this.i18next.on.call(this.i18next, 'added', (lng, ns) => this.events.added.next({ lng, ns }));
        this.i18next.on.call(this.i18next, 'removed', (lng, ns) => this.events.removed.next({ lng, ns }));
    }
}
I18NextService.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.0.4", ngImport: i0, type: I18NextService, deps: [{ token: I18NEXT_ERROR_HANDLING_STRATEGY }, { token: I18NEXT_INSTANCE, optional: true }], target: i0.ɵɵFactoryTarget.Injectable });
I18NextService.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "15.0.4", ngImport: i0, type: I18NextService });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.0.4", ngImport: i0, type: I18NextService, decorators: [{
            type: Injectable
        }], ctorParameters: function () { return [{ type: undefined, decorators: [{
                    type: Inject,
                    args: [I18NEXT_ERROR_HANDLING_STRATEGY]
                }] }, { type: undefined, decorators: [{
                    type: Optional
                }, {
                    type: Inject,
                    args: [I18NEXT_INSTANCE]
                }] }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSTE4TmV4dFNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvbGliL0kxOE5leHRTZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUM3RCxPQUFPLEtBQUssSUFBSSxNQUFNLFNBQVMsQ0FBQztBQUVoQyxPQUFPLEVBQUUsK0JBQStCLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUVyRixPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0saUJBQWlCLENBQUM7O0FBTWhELE1BQU0sYUFBYSxHQUFjLElBQUksQ0FBQyxPQUFPLENBQUM7QUFHOUMsTUFBTSxPQUFPLGNBQWM7SUFtQ3pCLFlBRVUscUJBQW1ELEVBQ3JCLGVBQTJCO1FBRHpELDBCQUFxQixHQUFyQixxQkFBcUIsQ0FBOEI7UUFqQzdELFdBQU0sR0FBdUIsSUFBSSxhQUFhLEVBQUUsQ0FBQztRQW9DL0MsSUFBSSxDQUFDLE9BQU8sR0FBRyxlQUFlLElBQUksYUFBYSxDQUFDO0lBQ2xELENBQUM7SUFuQ0QsSUFBSSxRQUFRO1FBQ1YsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQztJQUMvQixDQUFDO0lBQ0QsSUFBSSxTQUFTO1FBQ1gsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQztJQUNoQyxDQUFDO0lBRUQsSUFBSSxPQUFPO1FBQ1QsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQztJQUM5QixDQUFDO0lBRUQsSUFBSSxPQUFPO1FBQ1QsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQztJQUM5QixDQUFDO0lBQ0QsSUFBSSxRQUFRO1FBQ1YsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQztJQUMvQixDQUFDO0lBQ0QsSUFBSSxLQUFLO1FBQ1AsT0FB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ZiwrQkFBK0IsYUFFbkIsZ0JBQWdCOytHQXRDM0IsY0FBYzsyRkFBZCxjQUFjO2tCQUQxQixVQUFVOzswQkFxQ04sTUFBTTsyQkFBQywrQkFBK0I7OzBCQUV0QyxRQUFROzswQkFBSSxNQUFNOzJCQUFDLGdCQUFnQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdCwgSW5qZWN0YWJsZSwgT3B0aW9uYWwgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0ICogYXMgaTE4biBmcm9tICdpMThuZXh0JztcclxuXHJcbmltcG9ydCB7IEkxOE5FWFRfRVJST1JfSEFORExJTkdfU1RSQVRFR1ksIEkxOE5FWFRfSU5TVEFOQ0UgfSBmcm9tICcuL0kxOE5FWFRfVE9LRU5TJztcclxuaW1wb3J0IHsgSTE4TmV4dEVycm9ySGFuZGxpbmdTdHJhdGVneSB9IGZyb20gJy4vSTE4TmV4dEVycm9ySGFuZGxpbmdTdHJhdGVnaWVzJztcclxuaW1wb3J0IHsgSTE4TmV4dEV2ZW50cyB9IGZyb20gJy4vSTE4TmV4dEV2ZW50cyc7XHJcbmltcG9ydCB7IEkxOE5leHRMb2FkUmVzdWx0IH0gZnJvbSAnLi9JMThOZXh0TG9hZFJlc3VsdCc7XHJcbmltcG9ydCB7IElUcmFuc2xhdGlvbkV2ZW50cyB9IGZyb20gJy4vSVRyYW5zbGF0aW9uRXZlbnRzJztcclxuaW1wb3J0IHsgSVRyYW5zbGF0aW9uU2VydmljZSB9IGZyb20gJy4vSVRyYW5zbGF0aW9uU2VydmljZSc7XHJcblxyXG5cclxuY29uc3QgaTE4bmV4dEdsb2JhbDogaTE4bi5pMThuID0gaTE4bi5kZWZhdWx0O1xyXG5cclxuQEluamVjdGFibGUoKVxyXG5leHBvcnQgY2xhc3MgSTE4TmV4dFNlcnZpY2UgaW1wbGVtZW50cyBJVHJhbnNsYXRpb25TZXJ2aWNlIHtcclxuXHJcbiAgcHJpdmF0ZSByZWFkb25seSBpMThuZXh0OiBpMThuLmkxOG47XHJcblxyXG4gIGV2ZW50czogSVRyYW5zbGF0aW9uRXZlbnRzID0gbmV3IEkxOE5leHRFdmVudHMoKTtcclxuXHJcbiAgZ2V0IGxhbmd1YWdlKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuaTE4bmV4dC5sYW5ndWFnZTtcclxuICB9XHJcbiAgZ2V0IGxhbmd1YWdlcygpIHtcclxuICAgIHJldHVybiB0aGlzLmkxOG5leHQubGFuZ3VhZ2VzO1xyXG4gIH1cclxuXHJcbiAgZ2V0IG9wdGlvbnMoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5pMThuZXh0Lm9wdGlvbnM7XHJcbiAgfVxyXG5cclxuICBnZXQgbW9kdWxlcygpIHtcclxuICAgIHJldHVybiB0aGlzLmkxOG5leHQubW9kdWxlcztcclxuICB9XHJcbiAgZ2V0IHNlcnZpY2VzKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuaTE4bmV4dC5zZXJ2aWNlcztcclxuICB9XHJcbiAgZ2V0IHN0b3JlKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuaTE4bmV4dC5zdG9yZTtcclxuICB9XHJcblxyXG4gIGdldCByZXNvbHZlZExhbmd1YWdlKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuaTE4bmV4dC5yZXNvbHZlZExhbmd1YWdlO1xyXG4gIH1cclxuXHJcbiAgZ2V0IGlzSW5pdGlhbGl6ZWQoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5pMThuZXh0LmlzSW5pdGlhbGl6ZWQ7XHJcbiAgfVxyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIEBJbmplY3QoSTE4TkVYVF9FUlJPUl9IQU5ETElOR19TVFJBVEVHWSlcclxuICAgIHByaXZhdGUgZXJyb3JIYW5kbGluZ1N0cmF0ZWd5OiBJMThOZXh0RXJyb3JIYW5kbGluZ1N0cmF0ZWd5LFxyXG4gICAgQE9wdGlvbmFsKCkgQEluamVjdChJMThORVhUX0lOU1RBTkNFKSBpMThuZXh0SW5zdGFuY2U/OiBpMThuLmkxOG5cclxuICApIHtcclxuICAgIHRoaXMuaTE4bmV4dCA9IGkxOG5leHRJbnN0YW5jZSA/PyBpMThuZXh0R2xvYmFsO1xyXG4gIH1cclxuXHJcbiAgdChrZXk6IHN0cmluZyB8IHN0cmluZ1tdLCBvcHRpb25zPzogKGkxOG4uVE9wdGlvbnNCYXNlICYgb2JqZWN0ICYgeyBkZWZhdWx0VmFsdWU/OiBzdHJpbmcgfCB1bmRlZmluZWQ7IH0pIHwgdW5kZWZpbmVkKTogaTE4bi5EZWZhdWx0VEZ1bmNSZXR1cm47XHJcbiAgdChrZXk6IHN0cmluZyB8IHN0cmluZ1tdIHwgKHN0cmluZyB8IFRlbXBsYXRlU3RyaW5nc0FycmF5KVtdLCBkZWZhdWx0VmFsdWU6IHN0cmluZywgb3B0aW9ucz86IChpMThuLlRPcHRpb25zQmFzZSAmIG9iamVjdCAmIHsgZGVmYXVsdFZhbHVlOiBzdHJpbmc7IH0pIHwgdW5kZWZpbmVkKTogaTE4bi5EZWZhdWx0VEZ1bmNSZXR1cm47XHJcbiAgdChrZXk6IHVua25vd24sIGRlZmF1bHRWYWx1ZU9yT3B0aW9ucz86IHVua25vd24sIG9wdGlvbnM/OiB1bmtub3duKTogaTE4bi5EZWZhdWx0VEZ1bmNSZXR1cm4ge1xyXG4gICAgY29uc3QgaGFzRGVmYXVsdCA9ICEhZGVmYXVsdFZhbHVlT3JPcHRpb25zICYmIHR5cGVvZiBkZWZhdWx0VmFsdWVPck9wdGlvbnMgPT09ICdzdHJpbmcnO1xyXG5cclxuICAgIHRoaXMuaTE4bmV4dC50LmJpbmQodGhpcy5pMThuZXh0KTtcclxuICAgIGlmIChoYXNEZWZhdWx0KSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmkxOG5leHQudChrZXkgYXMgKHN0cmluZyB8IHN0cmluZ1tdKSwgZGVmYXVsdFZhbHVlT3JPcHRpb25zIGFzIHN0cmluZywgb3B0aW9ucyBhcyBpMThuLlRPcHRpb25zQmFzZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gdGhpcy5pMThuZXh0LnQoa2V5IGFzIChzdHJpbmcgfCBzdHJpbmdbXSksIGRlZmF1bHRWYWx1ZU9yT3B0aW9ucyBhcyBpMThuLlRPcHRpb25zQmFzZSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgdXNlPFQgZXh0ZW5kcyBpMThuLk1vZHVsZT4oXHJcbiAgICBtb2R1bGU6XHJcbiAgICBUIHwgaTE4bi5OZXdhYmxlTW9kdWxlPFQ+IHwgaTE4bi5OZXdhYmxlPFQ+XHJcbiAgKTogSVRyYW5zbGF0aW9uU2VydmljZSB7XHJcbiAgICB0aGlzLmkxOG5leHQudXNlLmNhbGwodGhpcy5pMThuZXh0LCBtb2R1bGUpO1xyXG4gICAgcmV0dXJuIHRoaXM7XHJcbiAgfVxyXG5cclxuICBpbml0KG9wdGlvbnM6IGkxOG4uSW5pdE9wdGlvbnMpOiBQcm9taXNlPEkxOE5leHRMb2FkUmVzdWx0PiB7XHJcbiAgICB0aGlzLnN1YnNjcmliZUV2ZW50cygpO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZTxJMThOZXh0TG9hZFJlc3VsdD4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICB0aGlzLmkxOG5leHQuaW5pdC5jYWxsKFxyXG4gICAgICAgIHRoaXMuaTE4bmV4dCxcclxuICAgICAgICBPYmplY3QuYXNzaWduKHt9LCBvcHRpb25zID8/IHt9KSxcclxuICAgICAgICB0aGlzLmVycm9ySGFuZGxpbmdTdHJhdGVneS5oYW5kbGUocmVzb2x2ZSwgcmVqZWN0KVxyXG4gICAgICApO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuXHJcblxyXG5cclxuICBwdWJsaWMgZm9ybWF0KHZhbHVlOiBhbnksIGZvcm1hdD86IHN0cmluZywgbG5nPzogc3RyaW5nKTogc3RyaW5nIHtcclxuICAgIHJldHVybiB0aGlzLmkxOG5leHQuZm9ybWF0LmNhbGwodGhpcy5pMThuZXh0LCB2YWx1ZSwgZm9ybWF0LCBsbmcsIHt9KTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBleGlzdHMoa2V5OiBzdHJpbmcgfCBzdHJpbmdbXSwgb3B0aW9uczogYW55KSB7XHJcbiAgICByZXR1cm4gdGhpcy5pMThuZXh0LmV4aXN0cy5jYWxsKHRoaXMuaTE4bmV4dCwga2V5LCBvcHRpb25zKTtcclxuICB9XHJcblxyXG4gIGdldEZpeGVkVChsbmc6IHN0cmluZyB8IHJlYWRvbmx5IHN0cmluZ1tdLCBucz86IHN0cmluZyB8IHJlYWRvbmx5IHN0cmluZ1tdLCBrZXlQcmVmaXg/OiBzdHJpbmcpOiBpMThuLlRGdW5jdGlvbjtcclxuICBnZXRGaXhlZFQobG5nOiBudWxsLCBuczogc3RyaW5nIHwgcmVhZG9ubHkgc3RyaW5nW10gfCBudWxsLCBrZXlQcmVmaXg/OiBzdHJpbmcpOiBpMThuLlRGdW5jdGlvbjtcclxuICBnZXRGaXhlZFQobG5nOiBhbnksIG5zPzogYW55LCBrZXlQcmVmaXg/OiBhbnkpOiBpMThuLlRGdW5jdGlvbiB7XHJcbiAgICByZXR1cm4gdGhpcy5pMThuZXh0LmdldEZpeGVkVC5jYWxsKHRoaXMuaTE4bmV4dCwgbG5nLCBucywga2V5UHJlZml4KTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzZXREZWZhdWx0TmFtZXNwYWNlKG5zOiBzdHJpbmcpIHtcclxuICAgIHRoaXMuaTE4bmV4dC5zZXREZWZhdWx0TmFtZXNwYWNlLmNhbGwodGhpcy5pMThuZXh0LCBucyk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZGlyKGxuZz86IHN0cmluZykge1xyXG4gICAgcmV0dXJuIHRoaXMuaTE4bmV4dC5kaXIuY2FsbCh0aGlzLmkxOG5leHQsIGxuZyk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgY2hhbmdlTGFuZ3VhZ2UobG5nOiBzdHJpbmcpOiBQcm9taXNlPGkxOG4uVEZ1bmN0aW9uPiB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2U8aTE4bi5URnVuY3Rpb24+KFxyXG4gICAgICAoXHJcbiAgICAgICAgcmVzb2x2ZTogKHRoZW5hYmxlT3JSZXN1bHQ6IGkxOG4uVEZ1bmN0aW9uIHwgUHJvbWlzZUxpa2U8aTE4bi5URnVuY3Rpb24+KSA9PiB2b2lkLFxyXG4gICAgICAgIHJlamVjdDogKGVycm9yOiBhbnkpID0+IHZvaWRcclxuICAgICAgKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaTE4bmV4dC5jaGFuZ2VMYW5ndWFnZS5jYWxsKFxyXG4gICAgICAgICAgdGhpcy5pMThuZXh0LFxyXG4gICAgICAgICAgbG5nLFxyXG4gICAgICAgICAgdGhpcy5lcnJvckhhbmRsaW5nU3RyYXRlZ3kuaGFuZGxlKHJlc29sdmUsIHJlamVjdClcclxuICAgICAgICApO1xyXG4gICAgICB9XHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGxvYWROYW1lc3BhY2VzKG5hbWVzcGFjZXM6IHN0cmluZyB8IHN0cmluZ1tdKTogUHJvbWlzZTxhbnk+IHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZTxJMThOZXh0TG9hZFJlc3VsdD4oXHJcbiAgICAgIChcclxuICAgICAgICByZXNvbHZlOiAodGhlbmFibGVPclJlc3VsdDogSTE4TmV4dExvYWRSZXN1bHQgfCBQcm9taXNlTGlrZTxJMThOZXh0TG9hZFJlc3VsdD4pID0+IHZvaWQsXHJcbiAgICAgICAgcmVqZWN0OiAoZXJyb3I6IGFueSkgPT4gdm9pZFxyXG4gICAgICApID0+IHtcclxuICAgICAgICB0aGlzLmkxOG5leHQubG9hZE5hbWVzcGFjZXMuY2FsbChcclxuICAgICAgICAgIHRoaXMuaTE4bmV4dCxcclxuICAgICAgICAgIG5hbWVzcGFjZXMsXHJcbiAgICAgICAgICB0aGlzLmVycm9ySGFuZGxpbmdTdHJhdGVneS5oYW5kbGUocmVzb2x2ZSwgcmVqZWN0KVxyXG4gICAgICAgICk7XHJcbiAgICAgIH1cclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgbG9hZExhbmd1YWdlcyhsbmdzOiBzdHJpbmcgfCBzdHJpbmdbXSkge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlPHZvaWQ+KFxyXG4gICAgICAoXHJcbiAgICAgICAgcmVzb2x2ZTogKHRoZW5hYmxlT3JSZXN1bHQ6IHZvaWQgfCBQcm9taXNlTGlrZTx2b2lkPikgPT4gdm9pZCxcclxuICAgICAgICByZWplY3Q6IChlcnJvcjogYW55KSA9PiB2b2lkXHJcbiAgICAgICkgPT4ge1xyXG4gICAgICAgIHRoaXMuaTE4bmV4dC5sb2FkTGFuZ3VhZ2VzLmNhbGwoXHJcbiAgICAgICAgICB0aGlzLmkxOG5leHQsXHJcbiAgICAgICAgICBsbmdzLFxyXG4gICAgICAgICAgdGhpcy5lcnJvckhhbmRsaW5nU3RyYXRlZ3kuaGFuZGxlKHJlc29sdmUsIHJlamVjdClcclxuICAgICAgICApO1xyXG4gICAgICB9XHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgLy8jcmVnaW9uIHJlc291cmNlIGhhbmRsaW5nXHJcblxyXG4gIHB1YmxpYyBsb2FkUmVzb3VyY2VzKGNhbGxiYWNrPzogKGVycjogYW55KSA9PiB2b2lkKTogdm9pZCB7XHJcbiAgICB0aGlzLmkxOG5leHQubG9hZFJlc291cmNlcy5jYWxsKHRoaXMuaTE4bmV4dCwgY2FsbGJhY2spO1xyXG4gIH1cclxuICBwdWJsaWMgZ2V0RGF0YUJ5TGFuZ3VhZ2UobG5nOiBzdHJpbmcpIHtcclxuICAgIHJldHVybiB0aGlzLmkxOG5leHQuZ2V0RGF0YUJ5TGFuZ3VhZ2UuY2FsbCh0aGlzLmkxOG5leHQsIGxuZyk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgYXN5bmMgcmVsb2FkUmVzb3VyY2VzKC4uLnBhcmFtczogYW55KSB7XHJcbiAgICBhd2FpdCB0aGlzLmkxOG5leHQucmVsb2FkUmVzb3VyY2VzLmFwcGx5KHRoaXMuaTE4bmV4dCwgcGFyYW1zKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRSZXNvdXJjZShsbmc6IHN0cmluZywgbnM6IHN0cmluZywga2V5OiBzdHJpbmcsIG9wdGlvbnM6IGFueSkge1xyXG4gICAgcmV0dXJuIHRoaXMuaTE4bmV4dC5nZXRSZXNvdXJjZS5jYWxsKHRoaXMuaTE4bmV4dCwgbG5nLCBucywga2V5LCBvcHRpb25zKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBhZGRSZXNvdXJjZShsbmc6IHN0cmluZywgbnM6IHN0cmluZywga2V5OiBzdHJpbmcsIHZhbHVlOiBhbnksIG9wdGlvbnM6IGFueSk6IGkxOG4uaTE4biB7XHJcbiAgICByZXR1cm4gdGhpcy5pMThuZXh0LmFkZFJlc291cmNlLmNhbGwodGhpcy5pMThuZXh0LCBsbmcsIG5zLCBrZXksIHZhbHVlLCBvcHRpb25zKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBhZGRSZXNvdXJjZXMobG5nOiBzdHJpbmcsIG5zOiBzdHJpbmcsIHJlc291cmNlczogYW55KTogaTE4bi5pMThuIHtcclxuICAgIHJldHVybiB0aGlzLmkxOG5leHQuYWRkUmVzb3VyY2VzLmNhbGwodGhpcy5pMThuZXh0LCBsbmcsIG5zLCByZXNvdXJjZXMpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGFkZFJlc291cmNlQnVuZGxlKGxuZzogc3RyaW5nLCBuczogc3RyaW5nLCByZXNvdXJjZXM6IGFueSwgZGVlcDogYW55LCBvdmVyd3JpdGU6IGFueSk6IGkxOG4uaTE4biB7XHJcbiAgICByZXR1cm4gdGhpcy5pMThuZXh0LmFkZFJlc291cmNlQnVuZGxlLmNhbGwoXHJcbiAgICAgIHRoaXMuaTE4bmV4dCxcclxuICAgICAgbG5nLFxyXG4gICAgICBucyxcclxuICAgICAgcmVzb3VyY2VzLFxyXG4gICAgICBkZWVwLFxyXG4gICAgICBvdmVyd3JpdGVcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgaGFzUmVzb3VyY2VCdW5kbGUobG5nOiBzdHJpbmcsIG5zOiBzdHJpbmcpIHtcclxuICAgIHJldHVybiB0aGlzLmkxOG5leHQuaGFzUmVzb3VyY2VCdW5kbGUuY2FsbCh0aGlzLmkxOG5leHQsIGxuZywgbnMpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldFJlc291cmNlQnVuZGxlKGxuZzogc3RyaW5nLCBuczogc3RyaW5nKSB7XHJcbiAgICByZXR1cm4gdGhpcy5pMThuZXh0LmdldFJlc291cmNlQnVuZGxlLmNhbGwodGhpcy5pMThuZXh0LCBsbmcsIG5zKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyByZW1vdmVSZXNvdXJjZUJ1bmRsZShsbmc6IHN0cmluZywgbnM6IHN0cmluZyk6IGkxOG4uaTE4biB7XHJcbiAgICByZXR1cm4gdGhpcy5pMThuZXh0LnJlbW92ZVJlc291cmNlQnVuZGxlLmNhbGwodGhpcy5pMThuZXh0LCBsbmcsIG5zKTtcclxuICB9XHJcblxyXG4gIC8vI2VuZHJlZ2lvblxyXG5cclxuICBwcml2YXRlIHN1YnNjcmliZUV2ZW50cygpIHtcclxuICAgIHRoaXMuaTE4bmV4dC5vbi5jYWxsKHRoaXMuaTE4bmV4dCwgJ2luaXRpYWxpemVkJywgKG9wdGlvbnM6IGkxOG4uSW5pdE9wdGlvbnMpID0+IHtcclxuICAgICAgdGhpcy5ldmVudHMuaW5pdGlhbGl6ZWQubmV4dChvcHRpb25zKTtcclxuICAgIH0pO1xyXG4gICAgdGhpcy5pMThuZXh0Lm9uLmNhbGwodGhpcy5pMThuZXh0LCAnbG9hZGVkJywgKGxvYWRlZDogYm9vbGVhbikgPT5cclxuICAgICAgdGhpcy5ldmVudHMubG9hZGVkLm5leHQobG9hZGVkKVxyXG4gICAgKTtcclxuICAgIHRoaXMuaTE4bmV4dC5vbi5jYWxsKHRoaXMuaTE4bmV4dCwgJ2ZhaWxlZExvYWRpbmcnLCAobG5nOiBzdHJpbmcsIG5zOiBzdHJpbmcsIG1zZzogc3RyaW5nKSA9PlxyXG4gICAgICB0aGlzLmV2ZW50cy5mYWlsZWRMb2FkaW5nLm5leHQoeyBsbmcsIG5zLCBtc2cgfSlcclxuICAgICk7XHJcbiAgICB0aGlzLmkxOG5leHQub24uY2FsbCh0aGlzLmkxOG5leHQsICdsYW5ndWFnZUNoYW5nZWQnLCAobG5nOiBzdHJpbmcpID0+IHtcclxuICAgICAgdGhpcy5ldmVudHMubGFuZ3VhZ2VDaGFuZ2VkLm5leHQobG5nKTtcclxuICAgIH0pO1xyXG4gICAgdGhpcy5pMThuZXh0Lm9uLmNhbGwodGhpcy5pMThuZXh0LCAnbWlzc2luZ0tleScsIChsbmdzOiBzdHJpbmcsIG5hbWVzcGFjZTogc3RyaW5nLCBrZXk6IHN0cmluZywgcmVzOiBhbnkpID0+XHJcbiAgICAgIHRoaXMuZXZlbnRzLm1pc3NpbmdLZXkubmV4dCh7IGxuZ3MsIG5hbWVzcGFjZSwga2V5LCByZXMgfSlcclxuICAgICk7XHJcbiAgICB0aGlzLmkxOG5leHQub24uY2FsbCh0aGlzLmkxOG5leHQsICdhZGRlZCcsIChsbmc6IHN0cmluZywgbnM6IHN0cmluZykgPT5cclxuICAgICAgdGhpcy5ldmVudHMuYWRkZWQubmV4dCh7IGxuZywgbnMgfSlcclxuICAgICk7XHJcbiAgICB0aGlzLmkxOG5leHQub24uY2FsbCh0aGlzLmkxOG5leHQsICdyZW1vdmVkJywgKGxuZzogc3RyaW5nLCBuczogc3RyaW5nKSA9PlxyXG4gICAgICB0aGlzLmV2ZW50cy5yZW1vdmVkLm5leHQoeyBsbmcsIG5zIH0pXHJcbiAgICApO1xyXG4gIH1cclxufVxyXG4iXX0=